{"version":3,"sources":["../src/source.ts"],"names":["SyncHook","bBoxToBounds","extent","padBounds","TilesetManager","EventEmitter","getParser","getTransform","cluster","statMap","getColumn","mergeCustomizer","objValue","srcValue","Array","isArray","Source","data","cfg","init","type","enable","radius","maxZoom","zoom","method","originData","initCfg","hooks","tap","excuteParser","initCluster","executeTrans","clusterIndex","getClusters","caculClusterExtent","id","getLeaves","Infinity","clusterOptions","field","Math","floor","forEach","p","properties","point_count","map","item","points","d","statNum","column","stat","features","parser","feature","length","newFeature","transforms","dataArrayChanged","dataArray","find","dataItem","_id","emit","value","options","removeAllListeners","tileset","destroy","option","call","sourceParser","setCenter","invalidExtent","initTileset","bbox","center","isNaN","tilesetOptions","updateOptions","trans","tran","Object","assign","bufferRatio","newBounds","concat"],"mappings":";;;;;;;;;;;;;;;;;;;;AACA,SAASA,QAAT,QAAyB,kBAAzB;AAWA,SACEC,YADF,EAEEC,MAFF,EAGEC,SAHF,EAIEC,cAJF,QAKO,gBALP;AAOA,SAASC,YAAT,QAA6B,eAA7B;AAKA,SAASC,SAAT,EAAoBC,YAApB,QAAwC,WAAxC;AACA,SAASC,OAAT,QAAwB,qBAAxB;AACA,SAASC,OAAT,QAAwB,oBAAxB;AACA,SAASC,SAAT,QAA0B,cAA1B;;AAEA,SAASC,eAAT,CAAyBC,QAAzB,EAAwCC,QAAxC,EAAuD;AACrD,MAAIC,KAAK,CAACC,OAAN,CAAcF,QAAd,CAAJ,EAA6B;AAC3B,WAAOA,QAAP;AACD;AACF;;IAEoBG,M;;;;;AAoCnB,kBAAYC,IAAZ,EAAiCC,GAAjC,EAAmD;AAAA;;AAAA;;AACjD;;AADiD;;AAAA;;AAAA;;AAAA,4DA9BpC;AACbC,MAAAA,IAAI,EAAE,IAAInB,QAAJ;AADO,KA8BoC;;AAAA,6DA1BvB;AAAEoB,MAAAA,IAAI,EAAE;AAAR,KA0BuB;;AAAA,iEAzBjB,EAyBiB;;AAAA,8DAxBzB,KAwByB;;AAAA,qEAvBD;AAChDC,MAAAA,MAAM,EAAE,KADwC;AAEhDC,MAAAA,MAAM,EAAE,EAFwC;AAGhDC,MAAAA,OAAO,EAAE,EAHuC;AAIhDC,MAAAA,IAAI,EAAE,CAAC,EAJyC;AAKhDC,MAAAA,MAAM,EAAE;AALwC,KAuBC;;AAAA;;AAAA;;AAAA,oEAXlB,KAWkB;;AAAA,uEATf,KASe;;AAAA;;AAAA;;AAAA,0DAJhC,EAIgC;;AAAA;;AAGjD,UAAKC,UAAL,GAAkBT,IAAlB;;AACA,UAAKU,OAAL,CAAaT,GAAb;;AAEA,UAAKU,KAAL,CAAWT,IAAX,CAAgBU,GAAhB,CAAoB,QAApB,EAA8B,YAAM;AAClC,YAAKC,YAAL;AACD,KAFD;;AAGA,UAAKF,KAAL,CAAWT,IAAX,CAAgBU,GAAhB,CAAoB,SAApB,EAA+B,YAAM;AACnC,YAAKE,WAAL;AACD,KAFD;;AAGA,UAAKH,KAAL,CAAWT,IAAX,CAAgBU,GAAhB,CAAoB,WAApB,EAAiC,YAAM;AACrC,YAAKG,YAAL;AACD,KAFD;;AAGA,UAAKb,IAAL;;AAfiD;AAgBlD;;;;WAED,qBAAmBK,IAAnB,EAAsC;AACpC,aAAO,KAAKS,YAAL,CAAkBC,WAAlB,CAA8B,KAAKC,kBAAL,CAAwB,CAAxB,CAA9B,EAA0DX,IAA1D,CAAP;AACD;;;WAED,2BAAyBY,EAAzB,EAA0C;AACxC,aAAO,KAAKH,YAAL,CAAkBI,SAAlB,CAA4BD,EAA5B,EAAgCE,QAAhC,CAAP;AACD;;;WAED,2BAAyBd,IAAzB,EAA6C;AAAA;;AAC3C,iCAAkC,KAAKe,cAAvC;AAAA,uDAAQd,MAAR;AAAA,UAAQA,MAAR,sCAAiB,KAAjB;AAAA,UAAwBe,KAAxB,wBAAwBA,KAAxB;AACA,UAAIvB,IAAI,GAAG,KAAKgB,YAAL,CAAkBC,WAAlB,CACT,KAAKC,kBAAL,CAAwB,CAAxB,CADS,EAETM,IAAI,CAACC,KAAL,CAAWlB,IAAX,CAFS,CAAX;AAIA,WAAKe,cAAL,CAAoBf,IAApB,GAA2BA,IAA3B;AACAP,MAAAA,IAAI,CAAC0B,OAAL,CAAa,UAACC,CAAD,EAAY;AACvB,YAAI,CAACA,CAAC,CAACR,EAAP,EAAW;AACTQ,UAAAA,CAAC,CAACC,UAAF,CAAaC,WAAb,GAA2B,CAA3B;AACD;AACF,OAJD;;AAKA,UAAIN,KAAK,IAAI,YAAWf,MAAX,CAAb,EAAiC;AAC/BR,QAAAA,IAAI,GAAGA,IAAI,CAAC8B,GAAL,CAAS,UAACC,IAAD,EAAe;AAC7B,cAAMZ,EAAE,GAAGY,IAAI,CAACZ,EAAhB;;AACA,cAAIA,EAAJ,EAAQ;AACN,gBAAMa,MAAM,GAAG,MAAI,CAAChB,YAAL,CAAkBI,SAAlB,CAA4BD,EAA5B,EAAgCE,QAAhC,CAAf;;AACA,gBAAMO,UAAU,GAAGI,MAAM,CAACF,GAAP,CAAW,UAACG,CAAD;AAAA,qBAAYA,CAAC,CAACL,UAAd;AAAA,aAAX,CAAnB;AACA,gBAAIM,OAAJ;;AACA,gBAAI,UAAS1B,MAAT,KAAoBe,KAAxB,EAA+B;AAC7B,kBAAMY,MAAM,GAAG1C,SAAS,CAACmC,UAAD,EAAaL,KAAb,CAAxB;AACAW,cAAAA,OAAO,GAAG1C,OAAO,CAACgB,MAAD,CAAP,CAAgB2B,MAAhB,CAAV;AACD;;AACD,gBAAI,YAAW3B,MAAX,CAAJ,EAAwB;AACtB0B,cAAAA,OAAO,GAAG1B,MAAM,CAACoB,UAAD,CAAhB;AACD;;AACDG,YAAAA,IAAI,CAACH,UAAL,CAAgBQ,IAAhB,GAAuBF,OAAvB;AACD,WAZD,MAYO;AACLH,YAAAA,IAAI,CAACH,UAAL,CAAgBC,WAAhB,GAA8B,CAA9B;AACD;;AACD,iBAAOE,IAAP;AACD,SAlBM,CAAP;AAmBD;;AACD,WAAK/B,IAAL,GAAYX,SAAS,CAAC,SAAD,CAAT,CAAqB;AAC/Bc,QAAAA,IAAI,EAAE,mBADyB;AAE/BkC,QAAAA,QAAQ,EAAErC;AAFqB,OAArB,CAAZ;AAIA,WAAKe,YAAL;AACD;;;WAED,wBAAsBI,EAAtB,EAA2C;AACzC,8BAA6B,KAAKmB,MAAlC,CAAQnC,IAAR;AAAA,UAAQA,IAAR,kCAAe,SAAf;;AACA,UAAIA,IAAI,KAAK,SAAT,IAAsB,CAAC,KAAKZ,OAAhC,EAAyC;AACvC,YAAMgD,OAAO,GACXpB,EAAE,GAAG,KAAKV,UAAL,CAAgB4B,QAAhB,CAAyBG,MAA9B,GACI,KAAK/B,UAAL,CAAgB4B,QAAhB,CAAyBlB,EAAzB,CADJ,GAEI,MAHN;;AAIA,YAAMsB,UAAU,GAAG,WAAUF,OAAV,CAAnB;;AAEA,YAAI,KAAKG,UAAL,CAAgBF,MAAhB,KAA2B,CAA3B,IAAgC,KAAKG,gBAAzC,EAA2D;AAEzD,cAAMZ,IAAI,GAAG,KAAK/B,IAAL,CAAU4C,SAAV,CAAoBC,IAApB,CAAyB,UAACC,QAAD,EAA8B;AAClE,mBAAOA,QAAQ,CAACC,GAAT,KAAiB5B,EAAxB;AACD,WAFY,CAAb;AAGAsB,UAAAA,UAAU,CAACb,UAAX,GAAwBG,IAAxB;AACD;;AACD,eAAOU,UAAP;AACD,OAfD,MAeO;AACL,eAAOtB,EAAE,GAAG,KAAKnB,IAAL,CAAU4C,SAAV,CAAoBJ,MAAzB,GAAkC,KAAKxC,IAAL,CAAU4C,SAAV,CAAoBzB,EAApB,CAAlC,GAA4D,MAAnE;AACD;AACF;;;WAED,qCACEA,EADF,EAEES,UAFF,EAGE;AACA,WAAK5B,IAAL,CAAU4C,SAAV,GAAsB,KAAK5C,IAAL,CAAU4C,SAAV,CAAoBd,GAApB,CACpB,UAACgB,QAAD,EAA8B;AAC5B,YAAIA,QAAQ,CAACC,GAAT,KAAiB5B,EAArB,EAAyB;AACvB,iDACK2B,QADL,GAEKlB,UAFL;AAID;;AACD,eAAOkB,QAAP;AACD,OATmB,CAAtB;AAWA,WAAKH,gBAAL,GAAwB,IAAxB;AACA,WAAKK,IAAL,CAAU,QAAV;AACD;;;WAED,sBAAoBzB,KAApB,EAAmC0B,KAAnC,EAAmE;AACjE,UAAMV,OAAO,GAAG,KAAKvC,IAAL,CAAU4C,SAAV,CAAoBC,IAApB,CAAyB,UAACC,QAAD,EAA8B;AACrE,eAAOA,QAAQ,CAACvB,KAAD,CAAR,KAAoB0B,KAA3B;AACD,OAFe,CAAhB;AAGA,aAAOV,OAAP,aAAOA,OAAP,uBAAOA,OAAO,CAAEQ,GAAhB;AACD;;;WAED,iBAAe/C,IAAf,EAA0BkD,OAA1B,EAAgD;AAC9C,WAAKzC,UAAL,GAAkBT,IAAlB;AACA,WAAK2C,gBAAL,GAAwB,KAAxB;AACA,WAAKjC,OAAL,CAAawC,OAAb;AACA,WAAKhD,IAAL;AACA,WAAK8C,IAAL,CAAU,QAAV;AACD;;;WAED,mBAAiB;AAAA;;AACf,WAAKG,kBAAL;AACA,WAAK1C,UAAL,GAAkB,IAAlB;AACA,WAAKO,YAAL,GAAoB,IAApB;AAEA,WAAKhB,IAAL,GAAY,IAAZ;AACA,4BAAKoD,OAAL,gEAAcC,OAAd;AACD;;;WAED,iBAAgBC,MAAhB,EAAqC;AACnC,WAAKrD,GAAL,GAAW,WAAU,KAAKA,GAAf,EAAoBqD,MAApB,EAA4B5D,eAA5B,CAAX;AACA,UAAMO,GAAG,GAAG,KAAKA,GAAjB;;AACA,UAAIA,GAAJ,EAAS;AACP,YAAIA,GAAG,CAACqC,MAAR,EAAgB;AACd,eAAKA,MAAL,GAAcrC,GAAG,CAACqC,MAAlB;AACD;;AACD,YAAIrC,GAAG,CAACyC,UAAR,EAAoB;AAClB,eAAKA,UAAL,GAAkBzC,GAAG,CAACyC,UAAtB;AACD;;AACD,aAAKnD,OAAL,GAAeU,GAAG,CAACV,OAAJ,IAAe,KAA9B;;AACA,YAAIU,GAAG,CAACqB,cAAR,EAAwB;AACtB,eAAK/B,OAAL,GAAe,IAAf;AACA,eAAK+B,cAAL,mCACK,KAAKA,cADV,GAEKrB,GAAG,CAACqB,cAFT;AAID;AACF;AACF;;;WAED,gBAAe;AACb,WAAKX,KAAL,CAAWT,IAAX,CAAgBqD,IAAhB,CAAqB,IAArB;AACD;;;WAKD,wBAA6B;AAC3B,UAAMjB,MAAM,GAAG,KAAKA,MAApB;AACA,UAAMnC,IAAY,GAAGmC,MAAM,CAACnC,IAAP,IAAe,SAApC;AACA,UAAMqD,YAAY,GAAGnE,SAAS,CAACc,IAAD,CAA9B;AACA,WAAKH,IAAL,GAAYwD,YAAY,CAAC,KAAK/C,UAAN,EAAkB6B,MAAlB,CAAxB;AAEA,WAAKrD,MAAL,GAAcA,MAAM,CAAC,KAAKe,IAAL,CAAU4C,SAAX,CAApB;AACA,WAAKa,SAAL,CAAe,KAAKxE,MAApB;AACA,WAAKyE,aAAL,GACE,KAAKzE,MAAL,CAAY,CAAZ,MAAmB,KAAKA,MAAL,CAAY,CAAZ,CAAnB,IAAqC,KAAKA,MAAL,CAAY,CAAZ,MAAmB,KAAKA,MAAL,CAAY,CAAZ,CAD1D;AAGA,WAAKmE,OAAL,GAAe,KAAKO,WAAL,EAAf;AACD;;;WAED,mBAAkBC,IAAlB,EAA8B;AAC5B,WAAKC,MAAL,GAAc,CAAC,CAACD,IAAI,CAAC,CAAD,CAAJ,GAAUA,IAAI,CAAC,CAAD,CAAf,IAAsB,CAAvB,EAA0B,CAACA,IAAI,CAAC,CAAD,CAAJ,GAAUA,IAAI,CAAC,CAAD,CAAf,IAAsB,CAAhD,CAAd;;AACA,UAAIE,KAAK,CAAC,KAAKD,MAAL,CAAY,CAAZ,CAAD,CAAL,IAAyBC,KAAK,CAAC,KAAKD,MAAL,CAAY,CAAZ,CAAD,CAAlC,EAAoD;AAGlD,aAAKA,MAAL,GAAc,CAAC,kBAAD,EAAqB,iBAArB,CAAd;AACD;AACF;;;WAKD,uBAAsB;AACpB,UAAQE,cAAR,GAA2B,KAAK/D,IAAhC,CAAQ+D,cAAR;;AACA,UAAI,CAACA,cAAL,EAAqB;AACnB;AACD;;AAED,UAAI,KAAKX,OAAT,EAAkB;AAChB,aAAKA,OAAL,CAAaY,aAAb,CAA2BD,cAA3B;AACA,eAAO,KAAKX,OAAZ;AACD;;AAED,UAAMA,OAAO,GAAG,IAAIjE,cAAJ,mBACX4E,cADW,EAAhB;AAGA,aAAOX,OAAP;AACD;;;WAKD,wBAAuB;AAAA;;AACrB,UAAMa,KAAK,GAAG,KAAKvB,UAAnB;AACAuB,MAAAA,KAAK,CAACvC,OAAN,CAAc,UAACwC,IAAD,EAAsB;AAClC,YAAQ/D,IAAR,GAAiB+D,IAAjB,CAAQ/D,IAAR;AAEA,YAAMH,IAAI,GAAGV,YAAY,CAACa,IAAD,CAAZ,CAAmB,MAAI,CAACH,IAAxB,EAA8BkE,IAA9B,CAAb;AACAC,QAAAA,MAAM,CAACC,MAAP,CAAc,MAAI,CAACpE,IAAnB,EAAyBA,IAAzB;AACD,OALD;AAMD;;;WAKD,uBAAsB;AACpB,UAAI,CAAC,KAAKT,OAAV,EAAmB;AACjB;AACD;;AAED,UAAM+B,cAAc,GAAG,KAAKA,cAAL,IAAuB,EAA9C;AACA,WAAKN,YAAL,GAAoBzB,OAAO,CAAC,KAAKS,IAAN,EAAYsB,cAAZ,CAA3B;AACD;;;WAED,4BAA2B+C,WAA3B,EAAqD;AACnD,UAAIC,SAAS,GAAG,CACd,CAAC,CAACjD,QAAF,EAAY,CAACA,QAAb,CADc,EAEd,CAACA,QAAD,EAAWA,QAAX,CAFc,CAAhB;;AAKA,UAAI,CAAC,KAAKqC,aAAV,EAAyB;AACvBY,QAAAA,SAAS,GAAGpF,SAAS,CAACF,YAAY,CAAC,KAAKC,MAAN,CAAb,EAA4BoF,WAA5B,CAArB;AACD;;AACD,aAAOC,SAAS,CAAC,CAAD,CAAT,CAAaC,MAAb,CAAoBD,SAAS,CAAC,CAAD,CAA7B,CAAP;AACD;;;;EAjRiClF,Y;;SAAfW,M","sourcesContent":["// @ts-ignore\nimport { SyncHook } from '@antv/async-hook';\nimport {\n  IClusterOptions,\n  IMapService,\n  IParseDataItem,\n  IParserCfg,\n  IParserData,\n  ISource,\n  ISourceCFG,\n  ITransform,\n} from '@antv/l7-core';\nimport {\n  bBoxToBounds,\n  extent,\n  padBounds,\n  TilesetManager,\n} from '@antv/l7-utils';\nimport { BBox } from '@turf/helpers';\nimport { EventEmitter } from 'eventemitter3';\nimport { cloneDeep, isFunction, isString, mergeWith } from 'lodash';\n// @ts-ignore\n// tslint:disable-next-line:no-submodule-imports\nimport Supercluster from 'supercluster/dist/supercluster';\nimport { getParser, getTransform } from './factory';\nimport { cluster } from './transform/cluster';\nimport { statMap } from './utils/statistics';\nimport { getColumn } from './utils/util';\n\nfunction mergeCustomizer(objValue: any, srcValue: any) {\n  if (Array.isArray(srcValue)) {\n    return srcValue;\n  }\n}\n\nexport default class Source extends EventEmitter implements ISource {\n  public data: IParserData;\n  public center: [number, number];\n  // 数据范围\n  public extent: BBox;\n  // 生命周期钩子\n  public hooks = {\n    init: new SyncHook(),\n  };\n\n  public parser: IParserCfg = { type: 'geojson' };\n  public transforms: ITransform[] = [];\n  public cluster: boolean = false;\n  public clusterOptions: Partial<IClusterOptions> = {\n    enable: false,\n    radius: 40,\n    maxZoom: 20,\n    zoom: -99,\n    method: 'count',\n  };\n\n  // 瓦片数据管理器\n  public tileset: TilesetManager | undefined;\n  private readonly mapService: IMapService;\n  // 是否有效范围\n  private invalidExtent: boolean = false;\n\n  private dataArrayChanged: boolean = false;\n\n  // 原始数据\n  private originData: any;\n  private rawData: any;\n  private cfg: any = {};\n\n  private clusterIndex: Supercluster;\n\n  constructor(data: any | ISource, cfg?: ISourceCFG) {\n    super();\n    // this.rawData = cloneDeep(data);\n    this.originData = data;\n    this.initCfg(cfg);\n\n    this.hooks.init.tap('parser', () => {\n      this.excuteParser();\n    });\n    this.hooks.init.tap('cluster', () => {\n      this.initCluster();\n    });\n    this.hooks.init.tap('transform', () => {\n      this.executeTrans();\n    });\n    this.init();\n  }\n\n  public getClusters(zoom: number): any {\n    return this.clusterIndex.getClusters(this.caculClusterExtent(2), zoom);\n  }\n\n  public getClustersLeaves(id: number): any {\n    return this.clusterIndex.getLeaves(id, Infinity);\n  }\n\n  public updateClusterData(zoom: number): void {\n    const { method = 'sum', field } = this.clusterOptions;\n    let data = this.clusterIndex.getClusters(\n      this.caculClusterExtent(2),\n      Math.floor(zoom),\n    );\n    this.clusterOptions.zoom = zoom;\n    data.forEach((p: any) => {\n      if (!p.id) {\n        p.properties.point_count = 1;\n      }\n    });\n    if (field || isFunction(method)) {\n      data = data.map((item: any) => {\n        const id = item.id as number;\n        if (id) {\n          const points = this.clusterIndex.getLeaves(id, Infinity);\n          const properties = points.map((d: any) => d.properties);\n          let statNum;\n          if (isString(method) && field) {\n            const column = getColumn(properties, field);\n            statNum = statMap[method](column);\n          }\n          if (isFunction(method)) {\n            statNum = method(properties);\n          }\n          item.properties.stat = statNum;\n        } else {\n          item.properties.point_count = 1;\n        }\n        return item;\n      });\n    }\n    this.data = getParser('geojson')({\n      type: 'FeatureCollection',\n      features: data,\n    });\n    this.executeTrans();\n  }\n\n  public getFeatureById(id: number): unknown {\n    const { type = 'geojson' } = this.parser;\n    if (type === 'geojson' && !this.cluster) {\n      const feature =\n        id < this.originData.features.length\n          ? this.originData.features[id]\n          : 'null';\n      const newFeature = cloneDeep(feature);\n\n      if (this.transforms.length !== 0 || this.dataArrayChanged) {\n        // 如果数据进行了transforms 属性会发生改变 或者数据dataArray发生更新\n        const item = this.data.dataArray.find((dataItem: IParseDataItem) => {\n          return dataItem._id === id;\n        });\n        newFeature.properties = item;\n      }\n      return newFeature;\n    } else {\n      return id < this.data.dataArray.length ? this.data.dataArray[id] : 'null';\n    }\n  }\n\n  public updateFeaturePropertiesById(\n    id: number,\n    properties: Record<string, any>,\n  ) {\n    this.data.dataArray = this.data.dataArray.map(\n      (dataItem: IParseDataItem) => {\n        if (dataItem._id === id) {\n          return {\n            ...dataItem,\n            ...properties,\n          };\n        }\n        return dataItem;\n      },\n    );\n    this.dataArrayChanged = true;\n    this.emit('update');\n  }\n\n  public getFeatureId(field: string, value: any): number | undefined {\n    const feature = this.data.dataArray.find((dataItem: IParseDataItem) => {\n      return dataItem[field] === value;\n    });\n    return feature?._id;\n  }\n\n  public setData(data: any, options?: ISourceCFG) {\n    this.originData = data;\n    this.dataArrayChanged = false;\n    this.initCfg(options);\n    this.init();\n    this.emit('update');\n  }\n\n  public destroy() {\n    this.removeAllListeners();\n    this.originData = null;\n    this.clusterIndex = null;\n    // @ts-ignore\n    this.data = null;\n    this.tileset?.destroy();\n  }\n\n  private initCfg(option?: ISourceCFG) {\n    this.cfg = mergeWith(this.cfg, option, mergeCustomizer);\n    const cfg = this.cfg;\n    if (cfg) {\n      if (cfg.parser) {\n        this.parser = cfg.parser;\n      }\n      if (cfg.transforms) {\n        this.transforms = cfg.transforms;\n      }\n      this.cluster = cfg.cluster || false;\n      if (cfg.clusterOptions) {\n        this.cluster = true;\n        this.clusterOptions = {\n          ...this.clusterOptions,\n          ...cfg.clusterOptions,\n        };\n      }\n    }\n  }\n\n  private init() {\n    this.hooks.init.call(this);\n  }\n\n  /**\n   * 数据解析\n   */\n  private excuteParser(): void {\n    const parser = this.parser;\n    const type: string = parser.type || 'geojson';\n    const sourceParser = getParser(type);\n    this.data = sourceParser(this.originData, parser);\n    // 计算范围\n    this.extent = extent(this.data.dataArray);\n    this.setCenter(this.extent);\n    this.invalidExtent =\n      this.extent[0] === this.extent[2] || this.extent[1] === this.extent[3];\n    // 瓦片数据\n    this.tileset = this.initTileset();\n  }\n\n  private setCenter(bbox: BBox) {\n    this.center = [(bbox[0] + bbox[2]) / 2, (bbox[1] + bbox[3]) / 2];\n    if (isNaN(this.center[0]) || isNaN(this.center[1])) {\n      // this.center = [Infinity, Infinity] // Infinity/Infinity = NaN\n      // 默认设置为大地原点\n      this.center = [108.92361111111111, 34.54083333333333];\n    }\n  }\n\n  /**\n   * 瓦片数据管理器\n   */\n  private initTileset() {\n    const { tilesetOptions } = this.data;\n    if (!tilesetOptions) {\n      return;\n    }\n\n    if (this.tileset) {\n      this.tileset.updateOptions(tilesetOptions);\n      return this.tileset;\n    }\n\n    const tileset = new TilesetManager({\n      ...tilesetOptions,\n    });\n    return tileset;\n  }\n\n  /**\n   * 数据统计\n   */\n  private executeTrans() {\n    const trans = this.transforms;\n    trans.forEach((tran: ITransform) => {\n      const { type } = tran;\n\n      const data = getTransform(type)(this.data, tran);\n      Object.assign(this.data, data);\n    });\n  }\n\n  /**\n   * 数据聚合\n   */\n  private initCluster() {\n    if (!this.cluster) {\n      return;\n    }\n\n    const clusterOptions = this.clusterOptions || {};\n    this.clusterIndex = cluster(this.data, clusterOptions);\n  }\n\n  private caculClusterExtent(bufferRatio: number): any {\n    let newBounds = [\n      [-Infinity, -Infinity],\n      [Infinity, Infinity],\n    ];\n\n    if (!this.invalidExtent) {\n      newBounds = padBounds(bBoxToBounds(this.extent), bufferRatio);\n    }\n    return newBounds[0].concat(newBounds[1]);\n  }\n}\n"],"file":"source.js"}