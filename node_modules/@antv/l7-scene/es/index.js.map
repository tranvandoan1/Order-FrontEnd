{"version":3,"sources":["../src/index.ts"],"names":["Logo","createLayerContainer","createSceneContainer","SceneEventList","TYPES","MaskLayer","ReglRendererService","DOM","isMini","Scene","config","id","map","canvas","hasBaseMap","sceneContainer","container","setContainer","bind","IRendererService","to","inSingletonScope","sceneService","get","ISceneService","mapService","IMapService","iconService","IIconService","fontService","IFontService","controlService","IControlService","layerService","ILayerService","markerService","IMarkerService","interactionService","IInteractionService","popupService","IPopupService","initMiniScene","initComponent","init","initControl","loaded","getSize","getMinZoom","getMaxZoom","getType","getMapContainer","getMapCanvasContainer","type","exportPng","render","renderSerivce","on","color","setBgColor","layer","layerContainer","addLayer","layerConfig","getLayerConfig","mask","maskfence","maskColor","maskOpacity","maskInstance","source","shape","style","opacity","addMask","console","warn","layerId","parent","getLayer","addMaskLayer","pickedLayerId","getLayers","name","getLayerByName","parentLayer","remove","removeAllLayers","flag","setEnableRender","fontUnicode","addIconFont","options","forEach","fontFamily","fontPath","addFontFace","img","addImage","addImageMini","hasImage","removeImage","glyphs","addIconGlyphs","ctr","addControl","removeControl","getControlByName","marker","addMarker","addMarkerLayer","removeMarkerLayer","removeAllMarkers","popup","addPopup","handle","indexOf","once","off","getZoom","getCenter","center","setCenter","getPitch","pitch","setPitch","getRotation","getBounds","rotation","setRotation","zoomIn","zoomOut","p","panTo","x","y","panBy","getContainer","zoom","setZoom","bound","getSceneConfig","fitBoundsOptions","animate","fitBounds","setZoomAndCenter","setMapStyle","setMapStatus","pixel","pixelToLngLat","lnglat","lngLatToPixel","containerToLngLat","lngLatToContainer","destroy","constructor","IPostProcessingPass","whenTargetNamed","enableShaderPick","disableShaderPick","getPointSizeRange","logoVisible","logoPosition","position"],"mappings":"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","sourcesContent":["import { Logo } from '@antv/l7-component';\nimport {\n  Bounds,\n  createLayerContainer,\n  createSceneContainer,\n  ICameraOptions,\n  IControl,\n  IControlService,\n  IFontService,\n  IIconFontGlyph,\n  IIconService,\n  IImage,\n  IInteractionService,\n  ILayer,\n  ILayerService,\n  ILngLat,\n  IMapService,\n  IMarker,\n  IMarkerLayer,\n  IMarkerService,\n  IPoint,\n  IPopup,\n  IPopupService,\n  IPostProcessingPass,\n  IRendererService,\n  ISceneConfig,\n  ISceneService,\n  IStatusOptions,\n  Point,\n  SceneEventList,\n  TYPES,\n} from '@antv/l7-core';\nimport { MaskLayer } from '@antv/l7-layers';\nimport { ReglRendererService } from '@antv/l7-renderer';\nimport { DOM, isMini } from '@antv/l7-utils';\nimport { Container } from 'inversify';\nimport ILayerManager from './ILayerManager';\nimport IMapController from './IMapController';\nimport IPostProcessingPassPluggable from './IPostProcessingPassPluggable';\n\n/**\n * 暴露 Scene API\n *\n * @example\n * import { Scene } from 'l7/scene';\n * import { PointLayer } from 'l7/layers';\n *\n * const scene = new Scene();\n * const pointLayer = new PointLayer();\n * scene.addLayer(pointLayer);\n *\n */\nclass Scene\n  implements IPostProcessingPassPluggable, IMapController, ILayerManager {\n  private sceneService: ISceneService;\n  private mapService: IMapService<unknown>;\n  private controlService: IControlService;\n  private layerService: ILayerService;\n  private iconService: IIconService;\n  private markerService: IMarkerService;\n  private popupService: IPopupService;\n  private fontService: IFontService;\n  private interactionService: IInteractionService;\n  private container: Container;\n\n  public constructor(config: ISceneConfig) {\n    const { id, map, canvas, hasBaseMap } = config;\n    // 创建场景容器\n    const sceneContainer = createSceneContainer();\n    this.container = sceneContainer;\n    // 绑定地图服务\n    map.setContainer(sceneContainer, id, canvas, hasBaseMap);\n\n    // 绑定渲染引擎服务\n    sceneContainer\n      .bind<IRendererService>(TYPES.IRendererService)\n      .to(ReglRendererService)\n      .inSingletonScope();\n\n    // 依赖注入\n    this.sceneService = sceneContainer.get<ISceneService>(TYPES.ISceneService);\n    this.mapService = sceneContainer.get<IMapService<unknown>>(\n      TYPES.IMapService,\n    );\n    this.iconService = sceneContainer.get<IIconService>(TYPES.IIconService);\n    this.fontService = sceneContainer.get<IFontService>(TYPES.IFontService);\n    this.controlService = sceneContainer.get<IControlService>(\n      TYPES.IControlService,\n    );\n    this.layerService = sceneContainer.get<ILayerService>(TYPES.ILayerService);\n\n    this.markerService = sceneContainer.get<IMarkerService>(\n      TYPES.IMarkerService,\n    );\n    this.interactionService = sceneContainer.get<IInteractionService>(\n      TYPES.IInteractionService,\n    );\n    this.popupService = sceneContainer.get<IPopupService>(TYPES.IPopupService);\n\n    if (isMini) {\n      this.sceneService.initMiniScene(config);\n    } else {\n      this.initComponent(id);\n\n      // 初始化 scene\n      this.sceneService.init(config);\n      // TODO: 初始化组件\n\n      this.initControl();\n    }\n  }\n\n  public get map() {\n    return this.mapService.map;\n  }\n\n  public get loaded() {\n    return this.sceneService.loaded;\n  }\n\n  public getServiceContainer(): Container {\n    return this.container;\n  }\n  public getSize(): [number, number] {\n    return this.mapService.getSize();\n  }\n  public getMinZoom(): number {\n    return this.mapService.getMinZoom();\n  }\n  public getMaxZoom(): number {\n    return this.mapService.getMaxZoom();\n  }\n  public getType(): string {\n    return this.mapService.getType();\n  }\n  public getMapContainer(): HTMLElement | null {\n    return this.mapService.getMapContainer();\n  }\n  public getMapCanvasContainer(): HTMLElement {\n    return this.mapService.getMapCanvasContainer() as HTMLElement;\n  }\n\n  public getMapService(): IMapService<unknown> {\n    return this.mapService;\n  }\n  public exportPng(type?: 'png' | 'jpg'): string {\n    return this.sceneService.exportPng(type);\n  }\n\n  public exportMap(type?: 'png' | 'jpg'): string {\n    return this.sceneService.exportPng(type);\n  }\n\n  public registerRenderService(render: any) {\n    if (this.sceneService.loaded) {\n      const renderSerivce = new render(this);\n      renderSerivce.init();\n    } else {\n      this.on('loaded', () => {\n        const renderSerivce = new render(this);\n        renderSerivce.init();\n      });\n    }\n  }\n\n  public setBgColor(color: string) {\n    this.mapService.setBgColor(color);\n  }\n\n  // layer 管理\n  public addLayer(layer: ILayer): void {\n    // 为当前图层创建一个容器\n    // TODO: 初始化的时候设置 容器\n    const layerContainer = createLayerContainer(this.container);\n    layer.setContainer(layerContainer, this.container);\n    this.sceneService.addLayer(layer);\n\n    const layerConfig = layer.getLayerConfig();\n    if (layerConfig) {\n      // 若 layer 未初始化成功，则 layerConfig 为 undefined （scene loaded 尚未执行完成）\n      const {\n        mask,\n        maskfence,\n        maskColor = '#000',\n        maskOpacity = 0,\n      } = layerConfig;\n      if (mask && maskfence) {\n        const maskInstance = new MaskLayer()\n          .source(maskfence)\n          .shape('fill')\n          .color(maskColor)\n          .style({\n            opacity: maskOpacity,\n          });\n\n        this.addMask(maskInstance, layer.id);\n      }\n    } else {\n      console.warn('addLayer should run after scene loaded!');\n    }\n  }\n\n  public addMask(mask: ILayer, layerId: string) {\n    const parent = this.getLayer(layerId);\n    if (parent) {\n      const layerContainer = createLayerContainer(this.container);\n      mask.setContainer(layerContainer, this.container);\n      parent.addMaskLayer(mask);\n      this.sceneService.addLayer(mask);\n    } else {\n      console.warn('parent layer not find!');\n    }\n  }\n\n  public getPickedLayer() {\n    return this.layerService.pickedLayerId;\n  }\n\n  public getLayers(): ILayer[] {\n    return this.layerService.getLayers();\n  }\n\n  public getLayer(id: string): ILayer | undefined {\n    return this.layerService.getLayer(id);\n  }\n\n  public getLayerByName(name: string): ILayer | undefined {\n    return this.layerService.getLayerByName(name);\n  }\n\n  public removeLayer(layer: ILayer, parentLayer?: ILayer): void {\n    this.layerService.remove(layer, parentLayer);\n  }\n\n  public removeAllLayer(): void {\n    this.layerService.removeAllLayers();\n  }\n\n  public render(): void {\n    this.sceneService.render();\n  }\n\n  public setEnableRender(flag: boolean) {\n    this.layerService.setEnableRender(flag);\n  }\n\n  // asset method\n  /**\n   * 为 layer/point/text 支持 iconfont 模式支持\n   * @param fontUnicode\n   * @param name\n   */\n  public addIconFont(name: string, fontUnicode: string): void {\n    this.fontService.addIconFont(name, fontUnicode);\n  }\n\n  public addIconFonts(options: string[][]): void {\n    options.forEach(([name, fontUnicode]) => {\n      this.fontService.addIconFont(name, fontUnicode);\n    });\n  }\n  /**\n   * 用户自定义添加第三方字体\n   * @param fontFamily\n   * @param fontPath\n   */\n  public addFontFace(fontFamily: string, fontPath: string): void {\n    this.sceneService.addFontFace(fontFamily, fontPath);\n  }\n\n  public addImage(id: string, img: IImage) {\n    if (!isMini) {\n      this.iconService.addImage(id, img);\n    } else {\n      this.iconService.addImageMini(id, img, this.sceneService);\n    }\n    // this.iconService.addImage(id, img);\n  }\n\n  public hasImage(id: string) {\n    return this.iconService.hasImage(id);\n  }\n\n  public removeImage(id: string) {\n    this.iconService.removeImage(id);\n  }\n\n  public addIconFontGlyphs(fontFamily: string, glyphs: IIconFontGlyph[]) {\n    this.fontService.addIconGlyphs(glyphs);\n  }\n\n  // map control method\n  public addControl(ctr: IControl) {\n    this.controlService.addControl(ctr, this.container);\n  }\n\n  public removeControl(ctr: IControl) {\n    this.controlService.removeControl(ctr);\n  }\n\n  public getControlByName(name: string) {\n    return this.controlService.getControlByName(name);\n  }\n\n  // marker\n  public addMarker(marker: IMarker) {\n    this.markerService.addMarker(marker);\n  }\n\n  public addMarkerLayer(layer: IMarkerLayer) {\n    this.markerService.addMarkerLayer(layer);\n  }\n\n  public removeMarkerLayer(layer: IMarkerLayer) {\n    this.markerService.removeMarkerLayer(layer);\n  }\n\n  public removeAllMakers() {\n    this.markerService.removeAllMarkers();\n  }\n\n  public addPopup(popup: IPopup) {\n    this.popupService.addPopup(popup);\n  }\n\n  public on(type: string, handle: (...args: any[]) => void): void {\n    SceneEventList.indexOf(type) === -1\n      ? this.mapService.on(type, handle)\n      : this.sceneService.on(type, handle);\n  }\n\n  public once(type: string, handle: (...args: any[]) => void): void {\n    SceneEventList.indexOf(type) === -1\n      ? this.mapService.once(type, handle)\n      : this.sceneService.once(type, handle);\n  }\n\n  public off(type: string, handle: (...args: any[]) => void): void {\n    SceneEventList.indexOf(type) === -1\n      ? this.mapService.off(type, handle)\n      : this.sceneService.off(type, handle);\n  }\n\n  // implements IMapController\n\n  public getZoom(): number {\n    return this.mapService.getZoom();\n  }\n\n  public getCenter(options?: ICameraOptions): ILngLat {\n    return this.mapService.getCenter(options);\n  }\n\n  public setCenter(center: [number, number], options?: ICameraOptions) {\n    return this.mapService.setCenter(center, options);\n  }\n\n  public getPitch(): number {\n    return this.mapService.getPitch();\n  }\n\n  public setPitch(pitch: number) {\n    return this.mapService.setPitch(pitch);\n  }\n\n  public getRotation(): number {\n    return this.mapService.getRotation();\n  }\n\n  public getBounds(): Bounds {\n    return this.mapService.getBounds();\n  }\n\n  public setRotation(rotation: number): void {\n    this.mapService.setRotation(rotation);\n  }\n  public zoomIn(): void {\n    this.mapService.zoomIn();\n  }\n\n  public zoomOut(): void {\n    this.mapService.zoomOut();\n  }\n\n  public panTo(p: Point): void {\n    this.mapService.panTo(p);\n  }\n\n  public panBy(x: number, y: number): void {\n    this.mapService.panBy(x, y);\n  }\n\n  public getContainer() {\n    return this.mapService.getContainer();\n  }\n  public setZoom(zoom: number): void {\n    this.mapService.setZoom(zoom);\n  }\n  public fitBounds(bound: Bounds, options?: unknown): void {\n    const { fitBoundsOptions, animate } = this.sceneService.getSceneConfig();\n    this.mapService.fitBounds(\n      bound,\n      // 选项优先级：用户传入，覆盖animate直接配置，覆盖Scene配置项传入\n      options || {\n        ...(fitBoundsOptions as object),\n        animate,\n      },\n    );\n  }\n\n  public setZoomAndCenter(zoom: number, center: Point): void {\n    this.mapService.setZoomAndCenter(zoom, center);\n  }\n\n  public setMapStyle(style: any): void {\n    this.mapService.setMapStyle(style);\n  }\n\n  public setMapStatus(options: Partial<IStatusOptions>) {\n    this.mapService.setMapStatus(options);\n  }\n\n  // conversion Method\n  public pixelToLngLat(pixel: Point): ILngLat {\n    return this.mapService.pixelToLngLat(pixel);\n  }\n\n  public lngLatToPixel(lnglat: Point): IPoint {\n    return this.mapService.lngLatToPixel(lnglat);\n  }\n\n  public containerToLngLat(pixel: Point): ILngLat {\n    return this.mapService.containerToLngLat(pixel);\n  }\n\n  public lngLatToContainer(lnglat: Point): IPoint {\n    return this.mapService.lngLatToContainer(lnglat);\n  }\n\n  public destroy() {\n    this.sceneService.destroy();\n    // TODO: 清理其他 Service 例如 IconService\n  }\n\n  public registerPostProcessingPass(\n    constructor: new (...args: any[]) => IPostProcessingPass<unknown>,\n    name: string,\n  ) {\n    this.container\n      .bind<IPostProcessingPass<unknown>>(TYPES.IPostProcessingPass)\n      .to(constructor)\n      .whenTargetNamed(name);\n  }\n\n  // 控制 shader pick 计算\n  public enableShaderPick() {\n    this.layerService.enableShaderPick();\n  }\n\n  public diasbleShaderPick() {\n    this.layerService.disableShaderPick();\n  }\n\n  // get current point size info\n  public getPointSizeRange() {\n    return this.sceneService.getPointSizeRange();\n  }\n\n  private initComponent(id: string | HTMLDivElement) {\n    this.controlService.init(\n      {\n        container: DOM.getContainer(id),\n      },\n      this.container,\n    );\n    this.markerService.init(this.container);\n    this.popupService.init(this.container);\n  }\n\n  private initControl() {\n    const { logoVisible, logoPosition } = this.sceneService.getSceneConfig();\n    if (logoVisible) {\n      this.addControl(new Logo({ position: logoPosition }));\n    }\n  }\n}\n\nexport { Scene };\n"],"file":"index.js"}